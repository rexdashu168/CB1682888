<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ å°è‚¡AIæ™ºèƒ½æŸ¥è©¢ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 80px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* é ­éƒ¨ */
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 22px;
            color: #667eea;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }

        /* æœå°‹ */
        .search-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .search-input-wrapper {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 80px 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 10px;
            font-size: 13px;
            cursor: pointer;
        }

        .result-area {
            display: none;
        }

        .company-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* å…¬å¸é ­éƒ¨ */
        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .company-name {
            font-size: 26px;
            font-weight: bold;
            color: #333;
        }

        .company-code {
            font-size: 14px;
            color: #667eea;
            margin-top: 5px;
        }

        .company-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: bold;
        }

        /* ç¶­åº¦å°èˆª */
        .dimension-nav {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }

        .dimension-btn {
            padding: 10px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .dimension-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* æ¨™é¡Œ */
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin: 25px 0 15px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 10px;
            border-radius: 2px;
        }

        /* è³‡æ–™æ ¼å­ */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .data-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            border-left: 3px solid #667eea;
        }

        .data-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .data-value {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            word-break: break-word;
        }

        .data-value.positive { color: #22c55e; }
        .data-value.negative { color: #ef4444; }

        /* å…§å®¹å¡ç‰‡ */
        .content-card {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .content-title {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        .content-text {
            font-size: 14px;
            line-height: 1.8;
            color: #555;
        }

        /* åˆ—è¡¨ */
        .content-list {
            margin: 0;
            padding: 0;
        }

        .content-list-item {
            padding: 8px 0 8px 25px;
            position: relative;
            line-height: 1.7;
        }

        .content-list-item::before {
            content: 'â€¢';
            position: absolute;
            left: 8px;
            color: #667eea;
            font-weight: bold;
            font-size: 18px;
        }

        /* å ±å‘Šå¡ç‰‡ */
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 15px;
            border: 2px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .report-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .report-card.expanded {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .report-date {
            font-size: 16px;
            color: #667eea;
            font-weight: bold;
        }

        .report-broker {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        .report-type {
            background: #667eea;
            color: white;
            padding: 6px 14px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .report-type:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .report-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 12px;
        }

        .report-detail {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #e0e0e0;
        }

        .report-card.expanded .report-detail {
            display: block;
        }

        /* æ™‚é–“è»¸ */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #667eea;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 10px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
        }

        .timeline-time {
            font-size: 14px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .timeline-event {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
        }

        .timeline-impact {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* QA */
        .qa-container {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .qa-item {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 2px dashed #e0e0e0;
        }

        .qa-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .qa-question {
            background: #667eea;
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
        }

        .qa-question::before {
            content: 'Q';
            background: white;
            color: #667eea;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .qa-answer {
            background: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.8;
            color: #555;
            border-left: 3px solid #22c55e;
        }

        .qa-answer::before {
            content: 'A: ';
            font-weight: bold;
            color: #22c55e;
            font-size: 15px;
        }

        /* æ¨™ç±¤ */
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .tag {
            padding: 6px 12px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 15px;
            font-size: 12px;
            color: #667eea;
            font-weight: 500;
        }

        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        /* ç”¢å“è¡¨æ ¼ */
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .product-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
        }

        .product-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
            line-height: 1.6;
        }

        .product-table tr:last-child td {
            border-bottom: none;
        }

        @media (max-width: 600px) {
            .company-name {
                font-size: 20px;
            }
            .data-grid {
                grid-template-columns: 1fr;
            }
            .report-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å°è‚¡AIæ™ºèƒ½æŸ¥è©¢ç³»çµ±</h1>
            <div class="subtitle">2269å®¶ä¸Šå¸‚æ«ƒ | 66ç¯‡æ·±åº¦å ±å‘Š | 1021å®¶CBå®Œæ•´è³‡è¨Š | 297å®¶CBç«¶æ‹å®Œæ•´è³‡è¨Š</div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalReports">-</div>
                    <div class="stat-label">ç ”ç©¶å ±å‘Š</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCompanies">-</div>
                    <div class="stat-label">è¿½è¹¤å…¬å¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalIndustries">-</div>
                    <div class="stat-label">ç”¢æ¥­åˆ†é¡</div>
                </div>
            </div>
        </div>

        <div class="search-box">
            <div class="search-input-wrapper">
                <input type="text" 
                       class="search-input" 
                       id="searchInput" 
                       placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨± (å¦‚: 2330 æˆ– å°ç©é›»)">
                <button class="search-btn" id="searchBtn">æŸ¥è©¢</button>
            </div>
        </div>

        <div class="result-area" id="resultArea">
            <div class="company-card" id="companyCard"></div>
        </div>
    </div>

    <script>

        // å…¨åŸŸè³‡æ–™è®Šæ•¸
        let RESEARCH_DATA = null;
        let dataLoaded = false;
        
        // è¼‰å…¥å¤–éƒ¨è³‡æ–™
        async function loadExternalData() {
            try {
                console.log('é–‹å§‹è¼‰å…¥ data.json...');
                const loadingText = document.getElementById('loadingText');
                const loadingDetail = document.getElementById('loadingDetail');
                if (loadingText) loadingText.textContent = 'æ­£åœ¨è¼‰å…¥è³‡æ–™æª”æ¡ˆ...';
                // å˜—è©¦å¤šå€‹å¯èƒ½çš„è·¯å¾‘
                const possiblePaths = [
                    'data.json',           // åŒç›®éŒ„
                    './data.json',         // æ˜ç¢ºçš„ç›¸å°è·¯å¾‘
                    '/data.json'           // æ ¹ç›®éŒ„
                ];
                
                let response = null;
                let lastError = null;
                
                for (const path of possiblePaths) {
                    try {
                        console.log('å˜—è©¦è¼‰å…¥:', path);
                        response = await fetch(path);
                        if (response.ok) {
                            console.log('âœ… æˆåŠŸ:', path);
                            break;
                        }
                    } catch (e) {
                        console.log('âŒ å¤±æ•—:', path, e.message);
                        lastError = e;
                    }
                }
                
                if (!response || !response.ok) {
                    const errorMsg = response 
                        ? `HTTP ${response.status}: ${response.statusText}` 
                        : 'ç„¡æ³•é€£æ¥åˆ° data.json';
                    throw new Error(errorMsg);
                }
                
                const rawData = await response.json();
                console.log('âœ… data.json è¼‰å…¥æˆåŠŸ');
                if (loadingText) loadingText.textContent = 'è³‡æ–™è¼‰å…¥æˆåŠŸï¼Œæ­£åœ¨è™•ç†...';
                if (loadingDetail) loadingDetail.textContent = 'è§£æè³‡æ–™ä¸­...';
                
                // è½‰æ›è³‡æ–™æ ¼å¼
                RESEARCH_DATA = convertRawData(rawData);
                dataLoaded = true;
                
                console.log('âœ… è³‡æ–™è½‰æ›å®Œæˆ');
                if (loadingText) loadingText.textContent = 'æº–å‚™å®Œæˆï¼';
                console.log('   å…¬å¸æ•¸:', Object.keys(RESEARCH_DATA.companies).length);
                console.log('   å ±å‘Šæ•¸:', RESEARCH_DATA.stats.total_reports);
                
                // éš±è—è¼‰å…¥ç•«é¢
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                }
                
                return true;
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥å¤±æ•—:', error);
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.innerHTML = `
                        <div style="text-align: center; color: red;">
                            <div style="font-size: 48px;">âŒ</div>
                            <div style="margin-top: 10px;">è³‡æ–™è¼‰å…¥å¤±æ•—</div>
                            <div style="font-size: 14px; margin-top: 5px; color: #666;">
                                ${error.message}
                            </div>
                            <div style="font-size: 12px; margin-top: 10px; color: #999;">
                                è«‹ç¢ºèª data.json æª”æ¡ˆæ˜¯å¦å­˜åœ¨æ–¼åŒä¸€ç›®éŒ„
                            </div>
                        </div>
                    `;
                }
                return false;
            }
        }
        
        // è½‰æ›åŸå§‹è³‡æ–™æ ¼å¼
        function convertRawData(rawData) {
            const converted = {
                stats: {
                    total_companies: 0,
                    companies_with_reports: 0,
                    total_reports: rawData.reports.length,
                    total_industries: 0
                },
                companies: {},
                reports_by_company: {}
            };
            
            // è½‰æ›å…¬å¸è³‡æ–™
            const industries = new Set();
            rawData.companies.forEach(company => {
                const code = company['ä»£è™Ÿ'] || company['è‚¡ç¥¨ä»£è™Ÿ'];
                if (!code) return;
                
                converted.companies[code] = {
                    stock_code: code,
                    company_name: company['å…¬å¸åç¨±'] || company['å…¬å¸ç°¡ç¨±'],
                    market: company['å¸‚å ´åˆ†é¡'],
                    industry: company['ç”¢æ¥­åˆ†é¡'],
                    industry_detail: company['ç”¢æ¥­ç´°åˆ†'],
                    industry_position: company['ç”¢æ¥­åœ°ä½èªªæ˜'],
                    chairman: company['è‘£äº‹é•·'],
                    ceo: company['ç¸½ç¶“ç†'],
                    capital: company['è‚¡æœ¬(å„„)'],
                    market_value: company['å¸‚å€¼(å„„)'],
                    price: company['æˆäº¤'],
                    volume: company['æˆäº¤é‡(åƒè‚¡)']
                };
                
                if (company['ç”¢æ¥­åˆ†é¡']) {
                    industries.add(company['ç”¢æ¥­åˆ†é¡']);
                }
            });
            
            converted.stats.total_companies = Object.keys(converted.companies).length;
            converted.stats.total_industries = industries.size;
            
            // è½‰æ›å ±å‘Šè³‡æ–™
            rawData.reports.forEach(report => {
                const code = report['è‚¡ç¥¨ä»£è™Ÿ'];
                if (!code) return;
                
                if (!converted.reports_by_company[code]) {
                    converted.reports_by_company[code] = [];
                }
                converted.reports_by_company[code].push(report);
                
                // å°‡å ±å‘Šé™„åŠ åˆ°å…¬å¸
                if (converted.companies[code]) {
                    if (!converted.companies[code].reports) {
                        converted.companies[code].reports = [];
                        converted.stats.companies_with_reports++;
                    }
                    converted.companies[code].reports.push(report);
                }
            });
            
            // è½‰æ› CB è³‡æ–™
            const cbStats = { companies_with_cb: 0 };
            const cbByCompany = {};
            
            // è™•ç†ç›®å‰æ›ç‰Œ CB
            rawData.cb.current.forEach(cb => {
                const code = cb['è½‰æ›æ¨™çš„ä»£ç¢¼'] ? String(cb['è½‰æ›æ¨™çš„ä»£ç¢¼']) : null;
                if (!code) return;
                
                if (!cbByCompany[code]) {
                    cbByCompany[code] = { has_cb: true, current_cb: [], history_cb: [], bid_cb: [] };
                    cbStats.companies_with_cb++;
                }
                cbByCompany[code].current_cb.push(cb);
            });
            
            // è™•ç†æ­·å² CB
            rawData.cb.history.forEach(cb => {
                const code = cb['è‚¡ç¥¨ä»£è™Ÿ'] ? String(cb['è‚¡ç¥¨ä»£è™Ÿ']) : null;
                if (!code) return;
                
                if (!cbByCompany[code]) {
                    cbByCompany[code] = { has_cb: true, current_cb: [], history_cb: [], bid_cb: [] };
                }
                cbByCompany[code].history_cb.push(cb);
            });
            
            // è™•ç†ç«¶æ‹ CB
            rawData.cb.bid.forEach(cb => {
                const code = cb['è‚¡ç¥¨ä»£è™Ÿ'] ? String(cb['è‚¡ç¥¨ä»£è™Ÿ']) : null;
                if (!code) return;
                
                if (!cbByCompany[code]) {
                    cbByCompany[code] = { has_cb: true, current_cb: [], history_cb: [], bid_cb: [] };
                }
                cbByCompany[code].bid_cb.push(cb);
            });
            
            // é™„åŠ  CB åˆ°å…¬å¸
            Object.keys(cbByCompany).forEach(code => {
                if (converted.companies[code]) {
                    converted.companies[code].cb_info = cbByCompany[code];
                }
            });
            
            converted.stats.cb_stats = cbStats;
            
            return converted;
        }
        class ResearchApp {
            constructor() {
                this.data = RESEARCH_DATA;
                this.currentCompany = null;
                this.init();
            }

            init() {
                this.updateStats();
                this.bindEvents();
            }

            bindEvents() {
                document.getElementById('searchBtn').addEventListener('click', () => this.handleSearch());
                document.getElementById('searchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSearch();
                });
            }

            updateStats() {
                document.getElementById('totalReports').textContent = this.data.stats.total_reports;
                document.getElementById('totalCompanies').textContent = this.data.stats.total_companies;
                document.getElementById('totalIndustries').textContent = this.data.stats.total_industries;
            }

            handleSearch() {
                const keyword = document.getElementById('searchInput').value.trim();
                const searchInput = document.getElementById('searchInput');
                
                if (!keyword) {
                    searchInput.style.borderColor = '#ef4444';
                    searchInput.placeholder = 'âŒ è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨±';
                    setTimeout(() => {
                        searchInput.style.borderColor = '#e0e0e0';
                        searchInput.placeholder = 'è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨± (å¦‚: 2330 æˆ– å°ç©é›»)';
                    }, 2000);
                    return;
                }

                let found = null;
                for (const [stockCode, company] of Object.entries(this.data.companies)) {
                    if (stockCode === keyword || company.company_name === keyword || 
                        company.company_name.includes(keyword)) {
                        found = stockCode;
                        break;
                    }
                }

                if (found) {
                    this.showCompany(found);
                } else {
                    searchInput.style.borderColor = '#ef4444';
                    searchInput.value = '';
                    searchInput.placeholder = 'âŒ æŸ¥ç„¡æ­¤å…¬å¸ (æ¸¬è©¦ç‰ˆï¼šæ™ºé‚¦ã€å‹¤èª ã€æ™¯ç¢©ã€å°ç©é›»ç­‰15å®¶)';
                    setTimeout(() => {
                        searchInput.style.borderColor = '#e0e0e0';
                        searchInput.placeholder = 'è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨± (å¦‚: 2330 æˆ– å°ç©é›»)';
                    }, 3000);
                }
            }

            showCompany(stockCode) {
                const company = this.data.companies[stockCode];
                this.currentCompany = company;
                document.getElementById('resultArea').style.display = 'block';
                this.renderCompanyCard(company);
                
                setTimeout(() => {
                    document.getElementById('resultArea').scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }

            renderCompanyCard(company) {
                const card = document.getElementById('companyCard');
                
                const header = `
                    <div class="company-header">
                        <div>
                            <div class="company-name">${company.company_name}</div>
                            <div class="company-code">${company.stock_code} | ${company.industry}</div>
                        </div>
                        <div class="company-badge">${company.status}</div>
                    </div>
                `;

                const nav = `
                    <div class="dimension-nav">
                        <button class="dimension-btn active" data-dim="overview">ğŸ“‹ å…¬å¸ç¸½è¦½</button>
                        <button class="dimension-btn" data-dim="finance">ğŸ’° è²¡å‹™è¡¨ç¾</button>
                        <button class="dimension-btn" data-dim="products">ğŸ“¦ ç”¢å“çµæ§‹</button>
                        <button class="dimension-btn" data-dim="reports">ğŸ“Š ç ”ç©¶å ±å‘Š</button>
                        <button class="dimension-btn" data-dim="timeline">â° é—œéµæ™‚ç¨‹</button>
                    </div>
                `;

                const content = this.renderOverview(company);
                card.innerHTML = header + nav + '<div id="content">' + content + '</div>';

                this.bindDimensionButtons(card, company);
            }

            bindDimensionButtons(card, company) {
                card.querySelectorAll('.dimension-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        card.querySelectorAll('.dimension-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        const dim = e.target.dataset.dim;
                        let html = '';
                        if (dim === 'overview') html = this.renderOverview(company);
                        else if (dim === 'finance') html = this.renderFinance(company);
                        else if (dim === 'products') html = this.renderProducts(company);
                        else if (dim === 'reports') html = this.renderReports(company);
                        else if (dim === 'timeline') html = this.renderTimeline(company);
                        document.getElementById('content').innerHTML = html;
                        
                        // é‡æ–°ç¶å®šå ±å‘Šå¡ç‰‡äº‹ä»¶
                        if (dim === 'reports') {
                            this.bindReportCards();
                        }
                    });
                });
            }

            renderOverview(c) {
                // å…¬å¸åŸºæœ¬è³‡è¨Š
                let html = '<div class="section-title">å…¬å¸åŸºæœ¬è³‡æ–™</div>';
                
                if (c.basic_info) {
                    const b = c.basic_info;
                    html += '<div class="data-grid">';
                    
                    if (b.market) html += '<div class="data-item"><div class="data-label">å¸‚å ´åˆ†é¡</div><div class="data-value">' + b.market + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">ç”¢æ¥­åˆ†é¡</div><div class="data-value">' + c.industry + '</div></div>';
                    if (b.chairman) html += '<div class="data-item"><div class="data-label">è‘£äº‹é•·</div><div class="data-value">' + b.chairman + '</div></div>';
                    if (b.ceo) html += '<div class="data-item"><div class="data-label">ç¸½ç¶“ç†</div><div class="data-value">' + b.ceo + '</div></div>';
                    if (b.years_established) html += '<div class="data-item"><div class="data-label">æˆç«‹å¹´æ•¸</div><div class="data-value">' + b.years_established + ' å¹´</div></div>';
                    if (b.years_listed) html += '<div class="data-item"><div class="data-label">æ›ç‰Œå¹´æ•¸</div><div class="data-value">' + b.years_listed + ' å¹´</div></div>';
                    
                    html += '</div>';
                    
                    // ç”¢æ¥­åœ°ä½
                    if (b.industry_position) {
                        html += '<div class="content-card" style="margin-top: 15px; background: #fff8e1; border-left-color: #ffa726;">';
                        html += '<div style="font-weight: bold; color: #f57c00; margin-bottom: 8px;">ç”¢æ¥­åœ°ä½</div>';
                        html += '<div style="font-size: 14px; color: #555;">' + this.escapeHtml(b.industry_position) + '</div>';
                        html += '</div>';
                    }
                    
                    // ç”¢æ¥­ç´°åˆ†èˆ‡ç›¸é—œåˆ†é¡
                    if (b.industry_detail || b.related_category) {
                        html += '<div class="section-title">ç”¢æ¥­åˆ†é¡è©³æƒ…</div>';
                        html += '<div class="content-card">';
                        
                        if (b.industry_detail) {
                            html += '<div style="margin-bottom: 12px;"><span style="font-weight: bold; color: #667eea;">ç”¢æ¥­ç´°åˆ†ï¼š</span>';
                            html += '<span style="color: #555;">' + this.escapeHtml(b.industry_detail) + '</span></div>';
                        }
                        
                        if (b.related_category) {
                            html += '<div><span style="font-weight: bold; color: #667eea;">ç›¸é—œåˆ†é¡ï¼š</span>';
                            html += '<span style="color: #555;">' + this.escapeHtml(b.related_category) + '</span></div>';
                        }
                        
                        html += '</div>';
                    }
                }
                
                // è‚¡åƒ¹èˆ‡äº¤æ˜“è³‡è¨Š
                html += '<div class="section-title">è‚¡åƒ¹èˆ‡äº¤æ˜“è³‡è¨Š</div>';
                html += '<div class="data-grid">';
                
                if (c.basic_info) {
                    const b = c.basic_info;
                    if (b.price) html += '<div class="data-item"><div class="data-label">è‚¡åƒ¹</div><div class="data-value">' + b.price + ' å…ƒ</div></div>';
                    if (b.price_change) {
                        const changeClass = b.price_change > 0 ? 'positive' : (b.price_change < 0 ? 'negative' : '');
                        html += '<div class="data-item"><div class="data-label">æ¼²è·Œ</div><div class="data-value ' + changeClass + '">' + (b.price_change > 0 ? '+' : '') + b.price_change + '</div></div>';
                    }
                    if (b.price_change_pct) {
                        const changeClass = b.price_change_pct > 0 ? 'positive' : (b.price_change_pct < 0 ? 'negative' : '');
                        html += '<div class="data-item"><div class="data-label">æ¼²è·Œå¹…</div><div class="data-value ' + changeClass + '">' + (b.price_change_pct > 0 ? '+' : '') + b.price_change_pct + '%</div></div>';
                    }
                    if (b.volume) html += '<div class="data-item"><div class="data-label">æˆäº¤å¼µæ•¸</div><div class="data-value">' + b.volume + ' å¼µ</div></div>';
                    if (b.capital) html += '<div class="data-item"><div class="data-label">è‚¡æœ¬</div><div class="data-value">' + b.capital + ' å„„</div></div>';
                    if (b.market_cap) html += '<div class="data-item"><div class="data-label">å¸‚å€¼</div><div class="data-value">' + b.market_cap + ' å„„</div></div>';
                }
                
                html += '</div>';
                
                // è¿½è¹¤ç‹€æ…‹
                html += '<div class="section-title">è¿½è¹¤ç‹€æ…‹</div>';
                html += '<div class="data-grid">';
                html += '<div class="data-item"><div class="data-label">è¿½è¹¤ç‹€æ…‹</div><div class="data-value">' + c.status + '</div></div>';
                html += '<div class="data-item"><div class="data-label">å ±å‘Šæ•¸é‡</div><div class="data-value">' + c.report_count + ' ç¯‡</div></div>';
                html += '<div class="data-item"><div class="data-label">æœ€æ–°å ±å‘Š</div><div class="data-value">' + (c.latest_report || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">æŠ•è³‡è©•ç­‰</div><div class="data-value">' + (c.rating || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">ç›®æ¨™åƒ¹</div><div class="data-value">' + (c.target_price || '-') + '</div></div>';
                html += '</div>';
                
                // é‡é»æ‘˜è¦
                if (c.memo) {
                    html += '<div class="section-title">é‡é»æ‘˜è¦</div>';
                    html += '<div class="content-card">' + this.formatTextWithBullets(c.memo) + '</div>';
                }
                
                // 3Q25 è²¡å‹™å¿«è¦½
                if (c.finance && Object.keys(c.finance).length > 0) {
                    const f = c.finance;
                    html += '<div class="section-title">3Q25 è²¡å‹™å¿«è¦½</div>';
                    html += '<div class="data-grid">';
                    html += '<div class="data-item"><div class="data-label">ç‡Ÿæ”¶</div><div class="data-value">' + (f.revenue_3q || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">ç‡Ÿæ”¶YoY</div><div class="data-value ' + this.getChangeClass(f.revenue_yoy) + '">' + (f.revenue_yoy || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">æ¯›åˆ©ç‡</div><div class="data-value">' + (f.gross_margin || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">EPS</div><div class="data-value">' + (f.eps || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">ç¨…å¾Œæ·¨åˆ©</div><div class="data-value">' + (f.net_profit || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">æ·¨åˆ©YoY</div><div class="data-value ' + this.getChangeClass(f.net_profit_yoy) + '">' + (f.net_profit_yoy || '-') + '</div></div>';
                    html += '</div>';
                }
                
                // ä¸»è¦ç”¢å“ç·š
                if (c.products && Object.keys(c.products).length > 0) {
                    const p = c.products;
                    html += '<div class="section-title">ä¸»è¦ç”¢å“ç·š</div>';
                    html += '<div class="data-grid">';
                    
                    if (p.product1 && p.product1.name) {
                        html += '<div class="data-item"><div class="data-label">' + this.escapeHtml(p.product1.name) + '</div>';
                        html += '<div class="data-value" style="font-size: 13px;">' + this.escapeHtml(p.product1.performance) + '</div></div>';
                    }
                    if (p.product2 && p.product2.name) {
                        html += '<div class="data-item"><div class="data-label">' + this.escapeHtml(p.product2.name) + '</div>';
                        html += '<div class="data-value" style="font-size: 13px;">' + this.escapeHtml(p.product2.performance) + '</div></div>';
                    }
                    if (p.product3 && p.product3.name) {
                        html += '<div class="data-item"><div class="data-label">' + this.escapeHtml(p.product3.name) + '</div>';
                        html += '<div class="data-value" style="font-size: 13px;">' + this.escapeHtml(p.product3.performance) + '</div></div>';
                    }
                    
                    html += '</div>';
                    
                    // é—œéµæˆé•·å‹•èƒ½
                    if (p.growth_driver) {
                        html += '<div class="section-title">é—œéµæˆé•·å‹•èƒ½</div>';
                        html += '<div class="content-card">' + this.formatTextWithBullets(p.growth_driver) + '</div>';
                    }
                    
                    // 2026å±•æœ›
                    if (p.outlook_2026) {
                        html += '<div class="section-title">2026 å±•æœ›</div>';
                        html += '<div class="content-card">' + this.formatTextWithBullets(p.outlook_2026) + '</div>';
                    }
                }
                
                // è¿‘æœŸé—œéµæ™‚ç¨‹
                if (c.timeline && c.timeline.length > 0) {
                    html += '<div class="section-title">è¿‘æœŸé—œéµæ™‚ç¨‹</div>';
                    html += '<div class="content-card">';
                    c.timeline.slice(0, 3).forEach(event => {
                        html += '<div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #e0e0e0;">';
                        html += '<div style="color: #667eea; font-weight: bold; margin-bottom: 4px;">' + event.time + ' ' + (event.importance || '') + '</div>';
                        html += '<div style="font-size: 14px; color: #555;">' + event.event + '</div>';
                        if (event.impact) {
                            html += '<div style="font-size: 12px; color: #999; margin-top: 4px;">å½±éŸ¿: ' + event.impact + '</div>';
                        }
                        html += '</div>';
                    });
                    if (c.timeline.length > 3) {
                        html += '<div style="text-align: center; color: #999; font-size: 12px;">æŸ¥çœ‹ã€Œâ° é—œéµæ™‚ç¨‹ã€äº†è§£æ›´å¤š...</div>';
                    }
                    html += '</div>';
                }
                
                return html;
            }

            renderFinance(c) {
                if (!c.finance || Object.keys(c.finance).length === 0) {
                    return '<div class="empty-state"><div class="empty-icon">ğŸ“Š</div>æš«ç„¡è²¡å‹™æ•¸æ“š</div>';
                }
                
                const f = c.finance;
                let html = '<div class="section-title">3Q25 è²¡å‹™è¡¨ç¾</div>';
                html += '<div class="data-grid">';
                html += '<div class="data-item"><div class="data-label">ç‡Ÿæ”¶</div><div class="data-value">' + (f.revenue_3q || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">ç‡Ÿæ”¶YoY</div><div class="data-value ' + this.getChangeClass(f.revenue_yoy) + '">' + (f.revenue_yoy || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">ç‡Ÿæ”¶QoQ</div><div class="data-value ' + this.getChangeClass(f.revenue_qoq) + '">' + (f.revenue_qoq || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">æ¯›åˆ©ç‡</div><div class="data-value">' + (f.gross_margin || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">æ¯›åˆ©ç‡YoY</div><div class="data-value ' + this.getChangeClass(f.gross_margin_yoy) + '">' + (f.gross_margin_yoy || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">ç¨…å¾Œæ·¨åˆ©</div><div class="data-value">' + (f.net_profit || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">æ·¨åˆ©YoY</div><div class="data-value ' + this.getChangeClass(f.net_profit_yoy) + '">' + (f.net_profit_yoy || '-') + '</div></div>';
                html += '<div class="data-item"><div class="data-label">EPS</div><div class="data-value">' + (f.eps || '-') + '</div></div>';
                html += '</div>';
                
                if (f.guidance_4q) {
                    html += '<div class="section-title">4Q25 æŒ‡å¼•</div>';
                    html += '<div class="content-card"><div class="content-text">' + this.escapeHtml(f.guidance_4q) + '</div></div>';
                }
                
                return html;
            }

            renderProducts(c) {
                if (!c.products || Object.keys(c.products).length === 0) {
                    return '<div class="empty-state"><div class="empty-icon">ğŸ“¦</div>æš«ç„¡ç”¢å“è³‡è¨Š</div>';
                }
                
                const p = c.products;
                let html = '<div class="section-title">ä¸»è¦ç”¢å“ç·š</div>';
                
                html += '<table class="product-table">';
                html += '<tr><th>ç”¢å“</th><th>è¡¨ç¾</th></tr>';
                
                if (p.product1 && p.product1.name) {
                    html += '<tr><td>' + this.escapeHtml(p.product1.name) + '</td><td>' + this.escapeHtml(p.product1.performance) + '</td></tr>';
                }
                if (p.product2 && p.product2.name) {
                    html += '<tr><td>' + this.escapeHtml(p.product2.name) + '</td><td>' + this.escapeHtml(p.product2.performance) + '</td></tr>';
                }
                if (p.product3 && p.product3.name) {
                    html += '<tr><td>' + this.escapeHtml(p.product3.name) + '</td><td>' + this.escapeHtml(p.product3.performance) + '</td></tr>';
                }
                
                html += '</table>';
                
                if (p.growth_driver) {
                    html += '<div class="section-title">é—œéµæˆé•·å‹•èƒ½</div>';
                    html += '<div class="content-card"><div class="content-text">' + this.escapeHtml(p.growth_driver) + '</div></div>';
                }
                
                if (p.outlook_2026) {
                    html += '<div class="section-title">2026 å±•æœ›</div>';
                    html += '<div class="content-card"><div class="content-text">' + this.escapeHtml(p.outlook_2026) + '</div></div>';
                }
                
                return html;
            }

            renderReports(c) {
                if (!c.reports || c.reports.length === 0) {
                    return '<div class="empty-state"><div class="empty-icon">ğŸ“­</div>æš«ç„¡å ±å‘Šè³‡æ–™</div>';
                }
                
                let html = '<div class="section-title">å…± ' + c.reports.length + ' ç¯‡ç ”ç©¶å ±å‘Š</div>';
                
                c.reports.forEach((r, idx) => {
                    const detail = c.detail.find(d => d.id === r.id);
                    
                    html += '<div class="report-card" data-report-id="' + r.id + '">';
                    html += '<div class="report-header">';
                    html += '<div><div class="report-date">' + r.date + '</div>';
                    html += '<div class="report-broker">' + r.broker + (r.analyst ? ' - ' + r.analyst : '') + '</div></div>';
                    html += '<div class="report-type">' + r.type + '</div>';
                    html += '</div>';
                    
                    html += '<div class="report-summary">';
                    html += '<div class="data-item"><div class="data-label">ç‡Ÿæ”¶YoY</div><div class="data-value">' + (r.revenue_yoy || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">æ¯›åˆ©ç‡</div><div class="data-value">' + (r.gross_margin || '-') + '</div></div>';
                    html += '<div class="data-item"><div class="data-label">EPS</div><div class="data-value">' + (r.eps || '-') + '</div></div>';
                    html += '</div>';
                    
                    if (detail) {
                        html += '<div class="report-detail">';
                        
                        if (detail.operations) {
                            html += '<div class="section-title">ç‡Ÿé‹é‡é»</div>';
                            html += '<div class="content-card">' + this.formatTextWithBullets(detail.operations) + '</div>';
                        }
                        
                        if (detail.strategy) {
                            html += '<div class="section-title">ç­–ç•¥æ–¹å‘</div>';
                            html += '<div class="content-card">' + this.formatTextWithBullets(detail.strategy) + '</div>';
                        }
                        
                        if (detail.qa && detail.qa !== 'å ±å‘Šæœªæä¾›QAå…§å®¹(å€‹è‚¡å ±å‘Šéæ³•èªªæœƒç´€éŒ„)') {
                            html += '<div class="section-title">é‡è¦QAæ‘˜è¦</div>';
                            html += '<div class="qa-container">' + this.formatQA(detail.qa) + '</div>';
                        }
                        
                        if (detail.rex_view) {
                            html += '<div class="section-title">Rexè§€å¯Ÿ</div>';
                            html += '<div class="content-card" style="background: #fff8e1; border-left-color: #ffa726;">';
                            html += this.formatTextWithBullets(detail.rex_view);
                            html += '</div>';
                        }
                        
                        if (detail.follow_up) {
                            html += '<div class="section-title">å¾ŒçºŒè¿½è¹¤</div>';
                            html += '<div class="content-card" style="background: #e8f5e9; border-left-color: #66bb6a;">';
                            html += this.formatTextWithBullets(detail.follow_up);
                            html += '</div>';
                        }
                        
                        if (detail.tags) {
                            const tags = detail.tags.split('#').filter(t => t.trim()).map(t => t.trim());
                            if (tags.length > 0) {
                                html += '<div class="tags">';
                                tags.forEach(tag => {
                                    html += '<div class="tag">#' + this.escapeHtml(tag) + '</div>';
                                });
                                html += '</div>';
                            }
                        }
                        
                        html += '</div>';
                    }
                    
                    html += '</div>';
                });
                
                return html;
            }

            renderTimeline(c) {
                if (!c.timeline || c.timeline.length === 0) {
                    return '<div class="empty-state"><div class="empty-icon">â°</div>æš«ç„¡æ™‚ç¨‹è³‡è¨Š</div>';
                }
                
                let html = '<div class="section-title">é—œéµäº‹ä»¶è¿½è¹¤</div>';
                html += '<div class="timeline">';
                
                c.timeline.forEach(event => {
                    html += '<div class="timeline-item">';
                    html += '<div class="timeline-time">' + event.time + ' ' + (event.importance || '') + '</div>';
                    html += '<div class="timeline-event"><strong>' + event.type + ':</strong> ' + event.event + '</div>';
                    if (event.impact) {
                        html += '<div class="timeline-impact">é æœŸå½±éŸ¿: ' + event.impact + '</div>';
                    }
                    html += '</div>';
                });
                
                html += '</div>';
                return html;
            }

            bindReportCards() {
                document.querySelectorAll('.report-card').forEach(card => {
                    // æ•´å¼µå¡ç‰‡éƒ½å¯ä»¥é»æ“Šå±•é–‹
                    card.addEventListener('click', (e) => {
                        card.classList.toggle('expanded');
                    });
                });
            }

            formatTextWithBullets(text) {
                let formatted = text;
                
                // è™•ç†æ•¸å­—ç·¨è™Ÿ (1. 2. 3. ç­‰) â†’ è½‰æˆ â€¢
                if (/^\d+\. /m.test(formatted)) {
                    formatted = formatted.replace(/^(\d+)\. (.+?)$/gm, '<div class="content-list-item">$2</div>');
                    formatted = '<div class="content-list">' + formatted + '</div>';
                    return formatted;
                }
                
                // è™•ç†é “è™Ÿåˆ†éš”ï¼ˆã€ï¼‰â†’ è½‰æˆ â€¢
                if (formatted.includes('ã€')) {
                    const parts = formatted.split('ã€').filter(p => p.trim());
                    if (parts.length > 1) {
                        formatted = '<div class="content-list">' + 
                            parts.map(p => '<div class="content-list-item">' + this.escapeHtml(p.trim()) + '</div>').join('') +
                            '</div>';
                        return formatted;
                    }
                }
                
                // ä¿æŒç ´æŠ˜è™Ÿï¼ˆ-ï¼‰åŸæ¨£ï¼Œä¸åšè½‰æ›
                return '<div class="content-text">' + this.escapeHtml(text) + '</div>';
            }

            parseQA(qaText) {
                const qaItems = [];
                
                if (qaText.includes('Q:') && qaText.includes('A:')) {
                    const parts = qaText.split(/;(?=Q:)/);
                    parts.forEach(part => {
                        const match = part.match(/Q:(.+?)\?A:(.+)/);
                        if (match) {
                            qaItems.push({
                                question: match[1].trim(),
                                answer: match[2].trim().replace(/;$/, '')
                            });
                        }
                    });
                }
                
                if (qaItems.length === 0 && (qaText.includes('Q1ï¼š') || qaText.includes('Q1:'))) {
                    const parts = qaText.split(/\n\n+/);
                    parts.forEach(part => {
                        const match = part.match(/Q\d*[ï¼š:](.*?)A[ï¼š:](.*)/s);
                        if (match) {
                            qaItems.push({
                                question: match[1].trim(),
                                answer: match[2].trim()
                            });
                        }
                    });
                }
                
                return qaItems;
            }

            formatQA(qaText) {
                const items = this.parseQA(qaText);
                
                if (items.length === 0) {
                    return '<div class="content-text">' + this.escapeHtml(qaText) + '</div>';
                }
                
                return items.map(item => `
                    <div class="qa-item">
                        <div class="qa-question">${this.escapeHtml(item.question)}</div>
                        <div class="qa-answer">${this.escapeHtml(item.answer)}</div>
                    </div>
                `).join('');
            }

            getChangeClass(value) {
                if (!value) return '';
                if (value.includes('+')) return 'positive';
                if (value.includes('-')) return 'negative';
                return '';
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        new ResearchApp();
    </script>
</body>
</html>
