<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rexå¤§å”å°è‚¡AIæ™ºèƒ½æŸ¥è©¢ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-size: 1.1em;
        }

        .search-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .search-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-button {
            padding: 15px 30px;
            border: none;
            background: none;
            color: #666;
            font-size: 1.1em;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-button {
            padding: 15px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-button:hover {
            background: #5568d3;
        }

        .quick-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-link {
            padding: 8px 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .quick-link:hover {
            background: #667eea;
            color: white;
        }

        .results-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        .result-card {
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .result-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .result-title {
            font-size: 1.8em;
            color: #333;
            font-weight: bold;
        }

        .result-badge {
            padding: 8px 20px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .result-section {
            margin-bottom: 25px;
        }

        .result-section h3 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-left: 15px;
            border-left: 4px solid #667eea;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .result-item {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .result-label {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .result-value {
            color: #333;
            font-size: 1.1em;
            font-weight: bold;
        }

        .result-value.positive {
            color: #e74c3c;
        }

        .result-value.negative {
            color: #27ae60;
        }

        .report-list {
            list-style: none;
        }

        .report-item {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cb-table {
            width: 100%;
            border-collapse: collapse;
        }

        .cb-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }

        .cb-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .cb-table tr:hover {
            background: #f9f9f9;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state svg {
            width: 150px;
            height: 150px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .search-box {
                flex-direction: column;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }

        .filter-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .filter-select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="header">
            <h1>ğŸ¤– Rexå¤§å”å°è‚¡AIæ™ºèƒ½æŸ¥è©¢ç³»çµ±</h1>
            <p>æ•´åˆç”¢æ¥­ç ”ç©¶ã€åˆ¸å•†å ±å‘Šã€å¯è½‰å‚µä¸‰å¤§è³‡æ–™åº«</p>
        </div>

        <!-- çµ±è¨ˆè³‡è¨Š -->
        <div class="stats">
            <div class="stat-card">
                <h3 id="stat-companies">2,277</h3>
                <p>ä¸Šå¸‚æ«ƒå…¬å¸</p>
            </div>
            <div class="stat-card">
                <h3 id="stat-reports">66</h3>
                <p>åˆ¸å•†ç ”ç©¶å ±å‘Š</p>
            </div>
            <div class="stat-card">
                <h3 id="stat-cb">2,232</h3>
                <p>å¯è½‰å‚µæª”æ•¸</p>
            </div>
            <div class="stat-card">
                <h3 id="stat-market">338</h3>
                <p>CBå¸‚å ´è¡Œæƒ…</p>
            </div>
        </div>

        <!-- æœå°‹å€ -->
        <div class="search-section">
            <!-- åŠŸèƒ½æ¨™ç±¤ -->
            <div class="search-tabs">
                <button class="tab-button active" onclick="switchTab('company')">
                    ğŸ“Š å…¬å¸æŸ¥è©¢
                </button>
                <button class="tab-button" onclick="switchTab('cb')">
                    ğŸ’° CBæŸ¥è©¢
                </button>
                <button class="tab-button" onclick="switchTab('industry')">
                    ğŸ“ˆ ç”¢æ¥­åˆ†æ
                </button>
                <button class="tab-button" onclick="switchTab('scan')">
                    ğŸ¯ æ©Ÿæœƒæƒæ
                </button>
            </div>

            <!-- å…¬å¸æŸ¥è©¢ -->
            <div id="tab-company" class="tab-content">
                <div class="search-box">
                    <input type="text" 
                           id="company-input" 
                           class="search-input" 
                           placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨± (ä¾‹å¦‚: 2330 æˆ– å°ç©é›»)"
                           onkeypress="if(event.key==='Enter') searchCompany()">
                    <button class="search-button" onclick="searchCompany()">
                        ğŸ” æŸ¥è©¢
                    </button>
                </div>
                <div class="quick-links">
                    <span style="color: #666; margin-right: 10px;">å¿«é€ŸæŸ¥è©¢ï¼š</span>
                    <button class="quick-link" onclick="quickSearch('2330')">å°ç©é›»</button>
                    <button class="quick-link" onclick="quickSearch('2317')">é´»æµ·</button>
                    <button class="quick-link" onclick="quickSearch('2454')">è¯ç™¼ç§‘</button>
                    <button class="quick-link" onclick="quickSearch('2412')">ä¸­è¯é›»</button>
                    <button class="quick-link" onclick="quickSearch('2882')">åœ‹æ³°é‡‘</button>
                    <button class="quick-link" onclick="quickSearch('2886')">å…†è±é‡‘</button>
                </div>
            </div>

            <!-- CBæŸ¥è©¢ -->
            <div id="tab-cb" class="tab-content" style="display:none;">
                <div class="search-box">
                    <input type="text" 
                           id="cb-input" 
                           class="search-input" 
                           placeholder="è¼¸å…¥CBåç¨±æˆ–ä»£è™Ÿ (ä¾‹å¦‚: é´»æµ·ä¸€)"
                           onkeypress="if(event.key==='Enter') searchCB()">
                    <button class="search-button" onclick="searchCB()">
                        ğŸ” æŸ¥è©¢
                    </button>
                </div>
            </div>

            <!-- ç”¢æ¥­åˆ†æ -->
            <div id="tab-industry" class="tab-content" style="display:none;">
                <div class="search-box">
                    <input type="text" 
                           id="industry-input" 
                           class="search-input" 
                           placeholder="è¼¸å…¥ç”¢æ¥­åç¨± (ä¾‹å¦‚: åŠå°é«”ã€é£Ÿå“ã€é‡‘è)"
                           onkeypress="if(event.key==='Enter') searchIndustry()">
                    <button class="search-button" onclick="searchIndustry()">
                        ğŸ” æŸ¥è©¢
                    </button>
                </div>
                <div class="quick-links">
                    <span style="color: #666; margin-right: 10px;">ç†±é–€ç”¢æ¥­ï¼š</span>
                    <button class="quick-link" onclick="searchIndustryDirect('åŠå°é«”')">åŠå°é«”</button>
                    <button class="quick-link" onclick="searchIndustryDirect('é›»å­é›¶çµ„ä»¶')">é›»å­é›¶çµ„ä»¶</button>
                    <button class="quick-link" onclick="searchIndustryDirect('é‡‘è')">é‡‘è</button>
                    <button class="quick-link" onclick="searchIndustryDirect('å¡‘è† ')">å¡‘è† </button>
                    <button class="quick-link" onclick="searchIndustryDirect('é£Ÿå“')">é£Ÿå“</button>
                </div>
            </div>

            <!-- æ©Ÿæœƒæƒæ -->
            <div id="tab-scan" class="tab-content" style="display:none;">
                <div class="filter-section">
                    <div class="filter-group">
                        <div class="filter-item">
                            <label class="filter-label">æº¢æŠ˜åƒ¹ç¯©é¸</label>
                            <select id="premium-filter" class="filter-select">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="discount">æŠ˜åƒ¹ï¼ˆ<0%ï¼‰</option>
                                <option value="low">ä½æº¢åƒ¹ï¼ˆ0-10%ï¼‰</option>
                                <option value="medium">ä¸­æº¢åƒ¹ï¼ˆ10-30%ï¼‰</option>
                                <option value="high">é«˜æº¢åƒ¹ï¼ˆ>30%ï¼‰</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">ç”¢æ¥­ç¯©é¸</label>
                            <select id="industry-filter" class="filter-select">
                                <option value="all">å…¨éƒ¨ç”¢æ¥­</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">é¡¯ç¤ºæ•¸é‡</label>
                            <select id="count-filter" class="filter-select">
                                <option value="10">10ç­†</option>
                                <option value="20" selected>20ç­†</option>
                                <option value="50">50ç­†</option>
                                <option value="100">100ç­†</option>
                            </select>
                        </div>
                    </div>
                    <button class="search-button" onclick="scanOpportunities()" style="width: 100%;">
                        ğŸ¯ é–‹å§‹æƒæCBæŠ•è³‡æ©Ÿæœƒ
                    </button>
                </div>
            </div>
        </div>

        <!-- çµæœé¡¯ç¤ºå€ -->
        <div class="results-section" id="results">
            <div class="empty-state">
                <svg viewBox="0 0 200 200" fill="currentColor">
                    <circle cx="100" cy="100" r="80" fill="none" stroke="currentColor" stroke-width="4"/>
                    <path d="M70 90 Q100 70 130 90" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
                    <circle cx="75" cy="80" r="8"/>
                    <circle cx="125" cy="80" r="8"/>
                </svg>
                <h2>è«‹é¸æ“‡åŠŸèƒ½é–‹å§‹æŸ¥è©¢</h2>
                <p>å¯ä»¥æŸ¥è©¢å…¬å¸è³‡è¨Šã€CBæŠ•è³‡æ©Ÿæœƒã€ç”¢æ¥­åˆ†æ</p>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let stockData = null;
        let currentTab = 'company';

        // è¼‰å…¥è³‡æ–™
        async function loadData() {
            try {
                const response = await fetch('stock_ai_data_full.json');
                stockData = await response.json();
                console.log('è³‡æ–™è¼‰å…¥æˆåŠŸï¼', stockData);
                
                // æ›´æ–°çµ±è¨ˆæ•¸å­—
                document.getElementById('stat-companies').textContent = stockData.industry_database.length.toLocaleString();
                document.getElementById('stat-reports').textContent = stockData.research_reports.length;
                document.getElementById('stat-cb').textContent = stockData.cb_basic.length.toLocaleString();
                document.getElementById('stat-market').textContent = stockData.cb_market.length;
                
                // è¼‰å…¥ç”¢æ¥­é¸é …
                loadIndustryOptions();
            } catch (error) {
                console.error('è³‡æ–™è¼‰å…¥å¤±æ•—:', error);
                showResults('<div class="empty-state"><h2>âš ï¸ è³‡æ–™è¼‰å…¥å¤±æ•—</h2><p>è«‹ç¢ºèª stock_ai_data_full.json æª”æ¡ˆä½ç½®</p></div>');
            }
        }

        // è¼‰å…¥ç”¢æ¥­é¸é …
        function loadIndustryOptions() {
            const industries = new Set();
            stockData.cb_market.forEach(cb => {
                if (cb['ç”¢æ¥­']) industries.add(cb['ç”¢æ¥­']);
            });
            
            const select = document.getElementById('industry-filter');
            Array.from(industries).sort().forEach(industry => {
                const option = document.createElement('option');
                option.value = industry;
                option.textContent = industry;
                select.appendChild(option);
            });
        }

        // åˆ‡æ›æ¨™ç±¤
        function switchTab(tab) {
            currentTab = tab;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é¡¯ç¤ºå°æ‡‰å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`tab-${tab}`).style.display = 'block';
            
            // æ¸…ç©ºçµæœ
            showResults('<div class="empty-state"><h2>è«‹è¼¸å…¥æŸ¥è©¢æ¢ä»¶</h2></div>');
        }

        // å¿«é€ŸæŸ¥è©¢
        function quickSearch(code) {
            document.getElementById('company-input').value = code;
            searchCompany();
        }

        // æŸ¥è©¢å…¬å¸
        function searchCompany() {
            if (!stockData) {
                alert('è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™...');
                return;
            }

            const input = document.getElementById('company-input').value.trim();
            if (!input) {
                alert('è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨±');
                return;
            }

            showResults('<div class="loading">ğŸ” æŸ¥è©¢ä¸­...</div>');

            // æœå°‹å…¬å¸
            let company = null;
            for (let c of stockData.industry_database) {
                if (c['ä»£è™Ÿ'] == input || c['å…¬å¸åç¨±'].includes(input)) {
                    company = c;
                    break;
                }
            }

            if (!company) {
                showResults(`<div class="empty-state"><h2>âŒ æ‰¾ä¸åˆ°ã€Œ${input}ã€</h2><p>è«‹æª¢æŸ¥è‚¡ç¥¨ä»£è™Ÿæˆ–å…¬å¸åç¨±</p></div>`);
                return;
            }

            // æŸ¥è©¢ç›¸é—œè³‡æ–™
            const stockCode = company['ä»£è™Ÿ'];
            const finance = stockData.financial_data.find(f => f['è‚¡è™Ÿ'] == stockCode);
            const product = stockData.product_analysis.find(p => p['è‚¡è™Ÿ'] == stockCode);
            const reports = stockData.research_reports.filter(r => r['è‚¡è™Ÿ'] == stockCode);
            const cbs = stockData.cb_basic.filter(cb => cb['è‚¡ç¥¨ä»£è™Ÿ'] == stockCode);

            // é¡¯ç¤ºçµæœ
            displayCompanyResult(company, finance, product, reports, cbs);
        }

        // é¡¯ç¤ºå…¬å¸çµæœ
        function displayCompanyResult(company, finance, product, reports, cbs) {
            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">${company['å…¬å¸åç¨±']} (${company['ä»£è™Ÿ']})</div>
                        <div class="result-badge">${company['ç”¢æ¥­åˆ†é¡']}</div>
                    </div>

                    <div class="result-section">
                        <h3>ğŸ“‹ åŸºæœ¬è³‡æ–™</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">ç”¢æ¥­ç´°åˆ†</div>
                                <div class="result-value">${company['ç”¢æ¥­ç´°åˆ†'] || 'N/A'}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">è‚¡æœ¬(å„„)</div>
                                <div class="result-value">${company['è‚¡æœ¬(å„„)'] || 'N/A'}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">å¸‚å€¼(å„„)</div>
                                <div class="result-value">${company['å¸‚å€¼(å„„)'] || 'N/A'}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">è‘£äº‹é•·</div>
                                <div class="result-value">${company['è‘£äº‹é•·'] || 'N/A'}</div>
                            </div>
                        </div>
                        ${company['ç”¢æ¥­åœ°ä½èªªæ˜'] ? `<div style="margin-top: 15px; padding: 15px; background: #f9f9f9; border-radius: 10px;"><strong>ç”¢æ¥­åœ°ä½ï¼š</strong>${company['ç”¢æ¥­åœ°ä½èªªæ˜']}</div>` : ''}
                    </div>
            `;

            if (finance) {
                html += `
                    <div class="result-section">
                        <h3>ğŸ’° è²¡å‹™è¡¨ç¾</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">ç‡Ÿæ”¶YoY</div>
                                <div class="result-value positive">${finance['ç‡Ÿæ”¶YoY'] || 'N/A'}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">æ¯›åˆ©ç‡</div>
                                <div class="result-value">${finance['æ¯›åˆ©ç‡'] || 'N/A'}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">EPS</div>
                                <div class="result-value">${finance['EPS'] || 'N/A'}</div>
                            </div>
                            ${finance['4Q25æŒ‡å¼•'] ? `<div class="result-item"><div class="result-label">4Q25æŒ‡å¼•</div><div class="result-value">${finance['4Q25æŒ‡å¼•']}</div></div>` : ''}
                        </div>
                    </div>
                `;
            }

            if (product) {
                html += `
                    <div class="result-section">
                        <h3>ğŸ“¦ ç”¢å“çµæ§‹</h3>
                        <div class="result-grid">
                            ${product['ä¸»è¦ç”¢å“1'] ? `<div class="result-item"><div class="result-label">ä¸»è¦ç”¢å“1</div><div class="result-value">${product['ä¸»è¦ç”¢å“1']}</div><div style="color: #888; margin-top: 5px;">${product['ä½”æ¯”/è¡¨ç¾1'] || ''}</div></div>` : ''}
                            ${product['ä¸»è¦ç”¢å“2'] ? `<div class="result-item"><div class="result-label">ä¸»è¦ç”¢å“2</div><div class="result-value">${product['ä¸»è¦ç”¢å“2']}</div><div style="color: #888; margin-top: 5px;">${product['ä½”æ¯”/è¡¨ç¾2'] || ''}</div></div>` : ''}
                            ${product['ä¸»è¦ç”¢å“3'] ? `<div class="result-item"><div class="result-label">ä¸»è¦ç”¢å“3</div><div class="result-value">${product['ä¸»è¦ç”¢å“3']}</div><div style="color: #888; margin-top: 5px;">${product['ä½”æ¯”/è¡¨ç¾3'] || ''}</div></div>` : ''}
                        </div>
                        ${product['é—œéµæˆé•·å‹•èƒ½'] ? `<div style="margin-top: 15px; padding: 15px; background: #f9f9f9; border-radius: 10px;"><strong>é—œéµæˆé•·å‹•èƒ½ï¼š</strong>${product['é—œéµæˆé•·å‹•èƒ½']}</div>` : ''}
                        ${product['2026å±•æœ›'] ? `<div style="margin-top: 10px; padding: 15px; background: #f9f9f9; border-radius: 10px;"><strong>2026å±•æœ›ï¼š</strong>${product['2026å±•æœ›']}</div>` : ''}
                    </div>
                `;
            }

            if (reports && reports.length > 0) {
                html += `
                    <div class="result-section">
                        <h3>ğŸ“Š åˆ¸å•†ç ”ç©¶å ±å‘Š (${reports.length}ç¯‡)</h3>
                        <ul class="report-list">
                `;
                reports.slice(0, 5).forEach(report => {
                    html += `
                        <li class="report-item">
                            <div>
                                <strong>${report['åˆ¸å•†']}</strong> - ${report['å ±å‘Šé¡å‹']}
                                <div style="color: #888; font-size: 0.9em;">${report['æ—¥æœŸ']}</div>
                            </div>
                            <div class="result-badge" style="background: #f39c12;">${report['é‡è¦æ€§']}</div>
                        </li>
                    `;
                });
                html += `</ul></div>`;
            }

            if (cbs && cbs.length > 0) {
                html += `
                    <div class="result-section">
                        <h3>ğŸ’ å¯è½‰å‚µ (${cbs.length}æª”)</h3>
                        <table class="cb-table">
                            <thead>
                                <tr>
                                    <th>åç¨±</th>
                                    <th>ä»£è™Ÿ</th>
                                    <th>è½‰æ›åƒ¹æ ¼</th>
                                    <th>ç™¼è¡Œè¦æ¨¡</th>
                                    <th>ä¿¡ç”¨æ“”ä¿</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                cbs.forEach(cb => {
                    html += `
                        <tr>
                            <td><strong>${cb['åç¨±']}</strong></td>
                            <td>${cb['CBä»£è™Ÿ']}</td>
                            <td>${cb['è½‰æ›åƒ¹æ ¼']}</td>
                            <td>${cb['ç™¼è¡Œè¦æ¨¡']}</td>
                            <td>${cb['ä¿¡ç”¨æ“”ä¿']}</td>
                        </tr>
                    `;
                });
                html += `</tbody></table></div>`;
            }

            html += '</div>';
            showResults(html);
        }

        // æŸ¥è©¢CB
        function searchCB() {
            if (!stockData) {
                alert('è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™...');
                return;
            }

            const input = document.getElementById('cb-input').value.trim();
            if (!input) {
                alert('è«‹è¼¸å…¥CBåç¨±æˆ–ä»£è™Ÿ');
                return;
            }

            showResults('<div class="loading">ğŸ” æŸ¥è©¢ä¸­...</div>');

            // æœå°‹CB
            const cb = stockData.cb_market.find(c => 
                c['åç¨±  '] && c['åç¨±  '].includes(input) || 
                c['ä»£ç¢¼'] == input
            );

            if (!cb) {
                showResults(`<div class="empty-state"><h2>âŒ æ‰¾ä¸åˆ°ã€Œ${input}ã€</h2><p>è«‹æª¢æŸ¥CBåç¨±æˆ–ä»£è™Ÿ</p></div>`);
                return;
            }

            displayCBResult(cb);
        }

        // é¡¯ç¤ºCBçµæœ
        function displayCBResult(cb) {
            const premium = parseFloat(cb['æº¢(æŠ˜)åƒ¹%']) || 0;
            const premiumClass = premium < 0 ? 'negative' : 'positive';

            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">${cb['åç¨±  ']}</div>
                        <div class="result-badge">${cb['ç”¢æ¥­']}</div>
                    </div>

                    <div class="result-section">
                        <h3>ğŸ’° å¸‚å ´è¡Œæƒ…</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">CBæ”¶ç›¤åƒ¹</div>
                                <div class="result-value">${cb['CBæ”¶ç›¤åƒ¹']}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">è‚¡åƒ¹</div>
                                <div class="result-value">${cb['è‚¡åƒ¹']}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">è½‰æ›åƒ¹æ ¼</div>
                                <div class="result-value">${cb['è½‰æ›åƒ¹æ ¼']}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">æº¢(æŠ˜)åƒ¹</div>
                                <div class="result-value ${premiumClass}">${premium.toFixed(2)}%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">YTM</div>
                                <div class="result-value">${parseFloat(cb['YTM']).toFixed(4)}%</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">å‰©é¤˜è½‰æ›æ¯”ç‡</div>
                                <div class="result-value">${cb['å‰©é¤˜æœªè½‰æ›æ¯”ç‡%']}%</div>
                            </div>
                        </div>
                    </div>

                    <div class="result-section">
                        <h3>ğŸ“… é‡è¦æ—¥æœŸ</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">ç™¼è¡Œæ—¥</div>
                                <div class="result-value">${cb['ç™¼è¡Œæ—¥']}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">æœ€è¿‘è³£å›æ—¥</div>
                                <div class="result-value">${cb['æœ€è¿‘è³£å›æ—¥'] || 'N/A'}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">åˆ°æœŸæ—¥</div>
                                <div class="result-value">${cb['åˆ°æœŸæ—¥']}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            showResults(html);
        }

        // æŸ¥è©¢ç”¢æ¥­
        function searchIndustry() {
            const input = document.getElementById('industry-input').value.trim();
            if (input) {
                searchIndustryDirect(input);
            }
        }

        function searchIndustryDirect(industry) {
            if (!stockData) {
                alert('è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™...');
                return;
            }

            showResults('<div class="loading">ğŸ” åˆ†æä¸­...</div>');

            // æ‰¾å‡ºè©²ç”¢æ¥­çš„å…¬å¸
            const companies = stockData.industry_database.filter(c => 
                c['ç”¢æ¥­åˆ†é¡'] && c['ç”¢æ¥­åˆ†é¡'].includes(industry)
            );

            if (companies.length === 0) {
                showResults(`<div class="empty-state"><h2>âŒ æ‰¾ä¸åˆ°ã€Œ${industry}ã€ç”¢æ¥­</h2></div>`);
                return;
            }

            // æ‰¾å‡ºè©²ç”¢æ¥­çš„CB
            const cbs = stockData.cb_market.filter(cb => 
                cb['ç”¢æ¥­'] && cb['ç”¢æ¥­'].includes(industry)
            );

            displayIndustryResult(industry, companies, cbs);
        }

        // é¡¯ç¤ºç”¢æ¥­çµæœ
        function displayIndustryResult(industry, companies, cbs) {
            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">${industry} ç”¢æ¥­åˆ†æ</div>
                        <div class="result-badge">${companies.length} å®¶å…¬å¸</div>
                    </div>

                    <div class="result-section">
                        <h3>ğŸ¢ ä»£è¡¨å…¬å¸ (å‰20å®¶)</h3>
                        <table class="cb-table">
                            <thead>
                                <tr>
                                    <th>ä»£è™Ÿ</th>
                                    <th>å…¬å¸åç¨±</th>
                                    <th>è‚¡æœ¬(å„„)</th>
                                    <th>å¸‚å€¼(å„„)</th>
                                    <th>ç”¢æ¥­åœ°ä½</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            companies.slice(0, 20).forEach(c => {
                html += `
                    <tr style="cursor: pointer;" onclick="quickSearch('${c['ä»£è™Ÿ']}')">
                        <td><strong>${c['ä»£è™Ÿ']}</strong></td>
                        <td>${c['å…¬å¸åç¨±']}</td>
                        <td>${c['è‚¡æœ¬(å„„)'] || 'N/A'}</td>
                        <td>${c['å¸‚å€¼(å„„)'] || 'N/A'}</td>
                        <td>${c['ç”¢æ¥­åœ°ä½èªªæ˜'] || 'N/A'}</td>
                    </tr>
                `;
            });

            html += `</tbody></table></div>`;

            if (cbs.length > 0) {
                html += `
                    <div class="result-section">
                        <h3>ğŸ’ ç›¸é—œCB (${cbs.length}æª”)</h3>
                        <table class="cb-table">
                            <thead>
                                <tr>
                                    <th>CBåç¨±</th>
                                    <th>è‚¡åƒ¹</th>
                                    <th>è½‰æ›åƒ¹</th>
                                    <th>æº¢æŠ˜åƒ¹</th>
                                    <th>YTM</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                cbs.forEach(cb => {
                    const premium = parseFloat(cb['æº¢(æŠ˜)åƒ¹%']) || 0;
                    const premiumClass = premium < 0 ? 'negative' : 'positive';
                    html += `
                        <tr>
                            <td><strong>${cb['åç¨±  ']}</strong></td>
                            <td>${cb['è‚¡åƒ¹']}</td>
                            <td>${cb['è½‰æ›åƒ¹æ ¼']}</td>
                            <td class="${premiumClass}">${premium.toFixed(2)}%</td>
                            <td>${parseFloat(cb['YTM']).toFixed(4)}%</td>
                        </tr>
                    `;
                });

                html += `</tbody></table></div>`;
            }

            html += '</div>';
            showResults(html);
        }

        // æƒææŠ•è³‡æ©Ÿæœƒ
        function scanOpportunities() {
            if (!stockData) {
                alert('è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™...');
                return;
            }

            showResults('<div class="loading">ğŸ¯ æƒæä¸­...</div>');

            const premiumFilter = document.getElementById('premium-filter').value;
            const industryFilter = document.getElementById('industry-filter').value;
            const count = parseInt(document.getElementById('count-filter').value);

            // ç¯©é¸CB
            let filtered = stockData.cb_market.filter(cb => {
                const premium = parseFloat(cb['æº¢(æŠ˜)åƒ¹%']) || 999;
                
                // æº¢æŠ˜åƒ¹ç¯©é¸
                if (premiumFilter === 'discount' && premium >= 0) return false;
                if (premiumFilter === 'low' && (premium < 0 || premium > 10)) return false;
                if (premiumFilter === 'medium' && (premium < 10 || premium > 30)) return false;
                if (premiumFilter === 'high' && premium <= 30) return false;
                
                // ç”¢æ¥­ç¯©é¸
                if (industryFilter !== 'all' && cb['ç”¢æ¥­'] !== industryFilter) return false;
                
                return true;
            });

            // æŒ‰æº¢æŠ˜åƒ¹æ’åº
            filtered.sort((a, b) => {
                const premiumA = parseFloat(a['æº¢(æŠ˜)åƒ¹%']) || 999;
                const premiumB = parseFloat(b['æº¢(æŠ˜)åƒ¹%']) || 999;
                return premiumA - premiumB;
            });

            displayScanResult(filtered.slice(0, count));
        }

        // é¡¯ç¤ºæƒæçµæœ
        function displayScanResult(opportunities) {
            if (opportunities.length === 0) {
                showResults('<div class="empty-state"><h2>ğŸ˜… æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„CB</h2><p>è«‹èª¿æ•´ç¯©é¸æ¢ä»¶</p></div>');
                return;
            }

            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">CBæŠ•è³‡æ©Ÿæœƒæƒæ</div>
                        <div class="result-badge">æ‰¾åˆ° ${opportunities.length} å€‹æ©Ÿæœƒ</div>
                    </div>

                    <div class="result-section">
                        <table class="cb-table">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>CBåç¨±</th>
                                    <th>ç”¢æ¥­</th>
                                    <th>è‚¡åƒ¹</th>
                                    <th>è½‰æ›åƒ¹</th>
                                    <th>æº¢æŠ˜åƒ¹</th>
                                    <th>YTM</th>
                                    <th>å‰©é¤˜æ¯”ç‡</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            opportunities.forEach((cb, index) => {
                const premium = parseFloat(cb['æº¢(æŠ˜)åƒ¹%']) || 0;
                const premiumClass = premium < 0 ? 'negative' : 'positive';
                html += `
                    <tr>
                        <td><strong>${index + 1}</strong></td>
                        <td><strong>${cb['åç¨±  ']}</strong></td>
                        <td>${cb['ç”¢æ¥­']}</td>
                        <td>${cb['è‚¡åƒ¹']}</td>
                        <td>${cb['è½‰æ›åƒ¹æ ¼']}</td>
                        <td class="${premiumClass}"><strong>${premium.toFixed(2)}%</strong></td>
                        <td>${parseFloat(cb['YTM']).toFixed(4)}%</td>
                        <td>${cb['å‰©é¤˜æœªè½‰æ›æ¯”ç‡%']}%</td>
                    </tr>
                `;
            });

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            showResults(html);
        }

        // é¡¯ç¤ºçµæœ
        function showResults(html) {
            document.getElementById('results').innerHTML = html;
            // æ»¾å‹•åˆ°çµæœå€
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = function() {
            loadData();
        };
    </script>
</body>
</html>
